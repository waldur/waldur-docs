# External Documentation Sources Configuration
# This file defines pull-based synchronization of documentation from remote repositories

sources:
  mastermind-api:
    name: "Waldur MasterMind API Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-mastermind.git"
    branch: "develop"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "docs/"
        local: "docs/developer-guide"
        description: "OpenAPI schemas and API documentation"
      - remote: "docs/admin"
        local: "docs/admin-guide/mastermind-configuration"
        description: "MasterMind administration guides"
    excludes:
      - "*.pyc"
      - "__pycache__"
      - ".git*"

  homeport-ui:
    name: "Waldur HomePort UI Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-homeport.git"
    branch: "develop"
    auth:
      token_env: "GITLAB_TOKEN"  # Environment variable containing auth token
    mappings:
      - remote: "docs/"
        local: "docs/developer-guide/ui"
        description: "UI development documentation"
    excludes:
      - "*.pyc"
      - "__pycache__"
      - ".git*"
      - "node_modules"

  docker-compose:
    name: "Waldur Docker Compose Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-docker-compose.git"
    branch: "develop"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/admin-guide/deployment/docker-compose/index.md"
        description: "Docker-compose-based deployment documentation"
    excludes:
      - ".git*"

  site-agent:
    name: "Waldur Site Agent Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-site-agent.git"
    branch: "main"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/admin-guide/providers/site-agent/index.md"
        description: "Waldur site agent docs root"
      - remote: "docs/"
        local: "docs/admin-guide/providers/site-agent/docs/"
        description: "Waldur site agent docs"
      - remote: "systemd-conf/"
        local: "docs/admin-guide/providers/site-agent/systemd-conf/"
        description: "Systemd config"
      - remote: "examples/"
        local: "docs/admin-guide/providers/site-agent/examples/"
        description: "Site agent config examples"
    excludes:
      - ".git*"

  keycloak-mapper:
    name: "Waldur Keycloak Mapper Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-keycloak-mapper.git"
    branch: "master"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/integrations/waldur-keycloak-mapper/index.md"
        description: "Waldur Keycloak Mapper documentation"
    excludes:
      - ".git*"

  ansible-waldur-generator:
    name: "Ansible Waldur Generator"
    repository: "https://code.opennodecloud.com/waldur/ansible-waldur-generator.git"
    branch: "main"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/integrator-guide/ansible/index.md"
        description: "Ansible Waldur Generator documentation root"
      - remote: "docs/"
        local: "docs/integrator-guide/ansible/docs/"
        description: "Ansible Waldur Generator documentation"
    excludes:
      - ".git*"

  waldur-helm:
    name: "Waldur Helm Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-helm.git"
    branch: "master"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
    - remote: "README.md"
      local: "docs/admin-guide/deployment/helm/index.md"
      description: "Waldur Helm docs root"
    - remote: "docs/"
      local: "docs/admin-guide/deployment/helm/docs/"
      description: "Waldur Helm docs"
    excludes:
      - ".git*"

  sdk-reference:
    name: "Waldur MasterMind API & SDK Reference"
    repository: "https://code.opennodecloud.com/waldur/waldur-sdk-docs-generator.git"
    branch: "main"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "output/"
        local: "docs/api-reference/"
        description: "Waldur MasterMind API & SDK Reference"
    excludes:
      - "*.pyc"
      - "__pycache__"
      - ".git*"

# Global settings
settings:
  # Directory for temporary clones
  temp_dir: ".temp_clones"

  # Marker for externally sourced files
  external_marker_template: |
    <!-- EXTERNAL DOCUMENT
    Source: {repository}
    Branch: {branch}
    Remote Path: {remote_path}
    Local Path: {local_path}
    Last Sync: {sync_time}

    WARNING: This file is automatically synchronized from the source repository.
    DO NOT EDIT this file directly. Changes will be overwritten.
    Edit the source at: {repository}/-/tree/{branch}/{remote_path}
    -->

  # Files to preserve locally even if not in remote
  preserve_local:
    - "index.md"
    - ".pages"
    - "README.md"
    - "waldur-ci-cd.md"
    - "release-orchestration.md"
    - "homeport.md"
    - "ad-hoc-scripts.md"
    - "developer-guide/img/2-pipeline-dt.png"
    - "developer-guide/img/1-pipeline-components.png"
    - "developer-guide/img/resource-details-mobile.png"
    - "developer-guide/img/CI-CD-general.png"
    - "developer-guide/img/3-pipeline-depl.png"
    - "developer-guide/img/resource-details.png"
    - "developer-guide/scripts/import_projects_with_slug.py"
    - "developer-guide/scripts/generate_openmetrics_usages.py"
    - "developer-guide/scripts/wipe-tenants.py"
    - "developer-guide/scripts/update_usages.py"
    - "general.md"
    - "admin-guide/mastermind-configuration/img/admin-example.png"
    - "admin-guide/mastermind-configuration/img/notification_templates_step_5.png"
    - "admin-guide/mastermind-configuration/img/notification_templates_step_4.png"
    - "admin-guide/mastermind-configuration/img/notification_templates_step_1.png"
    - "admin-guide/mastermind-configuration/img/notification_templates_step_2.png"
    - "admin-guide/mastermind-configuration/img/notification_templates_step_3.png"

  # Maximum age for considering a sync fresh (in hours)
  max_sync_age_hours: 24
