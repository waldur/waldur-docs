# External Documentation Sources Configuration
# This file defines pull-based synchronization of documentation from remote repositories

sources:
  homeport-ui:
    name: "Waldur HomePort UI Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-homeport.git"
    branch: "develop"
    auth:
      token_env: "GITLAB_TOKEN"  # Environment variable containing auth token
    mappings:
      - remote: "docs/"
        local: "docs/developer-guide/ui"
        description: "UI development documentation"
    excludes:
      - "*.pyc"
      - "__pycache__"
      - ".git*"
      - "node_modules"

  # TODO: restore after restructure
  # mastermind-api:
  #   name: "Waldur MasterMind API Documentation"
  #   repository: "https://code.opennodecloud.com/waldur/waldur-mastermind.git"
  #   branch: "develop"
  #   auth:
  #     token_env: "GITLAB_TOKEN"
  #   mappings:
  #     - remote: "docs/"
  #       local: "docs/developer-guide"
  #       description: "OpenAPI schemas and API documentation"
  #     - remote: "docs/admin"
  #       local: "docs/admin-guide/mastermind-configuration"
  #       description: "MasterMind administration guides"
  #   excludes:
  #     - "*.pyc"
  #     - "__pycache__"
  #     - ".git*"

  docker-compose:
    name: "Waldur Docker Compose Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-docker-compose.git"
    branch: "develop"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/admin-guide/deployment/docker-compose/index.md"
        description: "Docker-compose-based deployment documentation"
    excludes:
      - ".git*"

  site-agent:
    name: "Waldur Site Agent Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-site-agent.git"
    branch: "main"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/admin-guide/providers/site-agent/index.md"
        description: "Waldur site agent docs root"
      - remote: "docs/"
        local: "docs/admin-guide/providers/site-agent/docs/"
        description: "Waldur site agent docs"
      - remote: "systemd-conf/"
        local: "docs/admin-guide/providers/site-agent/systemd-conf/"
        description: "Systemd config"
      - remote: "examples/"
        local: "docs/admin-guide/providers/site-agent/examples/"
        description: "Site agent config examples"
    excludes:
      - ".git*"

  keycloak-mapper:
    name: "Waldur Keycloak Mapper Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-keycloak-mapper.git"
    branch: "master"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/integrations/waldur-keycloak-mapper/index.md"
        description: "Waldur Keycloak Mapper documentation"
    excludes:
      - ".git*"

  ansible-waldur-generator:
    name: "Ansible Waldur Generator"
    repository: "https://code.opennodecloud.com/waldur/ansible-waldur-generator.git"
    branch: "main"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
      - remote: "README.md"
        local: "docs/integrator-guide/ansible-module.md"
        description: "Ansible Waldur Generator documentation"
    excludes:
      - ".git*"

  waldur-helm:
    name: "Waldur Helm Documentation"
    repository: "https://code.opennodecloud.com/waldur/waldur-helm.git"
    branch: "master"
    auth:
      token_env: "GITLAB_TOKEN"
    mappings:
    - remote: "README.md"
      local: "docs/admin-guide/deployment/helm/index.md"
      description: "Waldur Helm docs root"
    - remote: "docs/"
      local: "docs/admin-guide/deployment/helm/docs/"
      description: "Waldur Helm docs"
    excludes:
      - ".git*"

# Global settings
settings:
  # Directory for temporary clones
  temp_dir: ".temp_clones"

  # Marker for externally sourced files
  external_marker_template: |
    <!-- EXTERNAL DOCUMENT
    Source: {repository}
    Branch: {branch}
    Remote Path: {remote_path}
    Local Path: {local_path}
    Last Sync: {sync_time}

    WARNING: This file is automatically synchronized from the source repository.
    DO NOT EDIT this file directly. Changes will be overwritten.
    Edit the source at: {repository}/-/tree/{branch}/{remote_path}
    -->

  # Files to preserve locally even if not in remote
  preserve_local:
    - "index.md"
    - ".pages"
    - "README.md"

  # Maximum age for considering a sync fresh (in hours)
  max_sync_age_hours: 24
